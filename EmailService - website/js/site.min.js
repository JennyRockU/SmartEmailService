async function GetappId(){let settingRes=await fetch('./settings.json');let data=await settingRes.json();return data.AppSettings.ApiKey}
async function SendEmail(recipient,sender,title,body){const url=getApiUrl(recipient,sender,title);let token=await GetappId();try{var res=await fetch(url,{method:"post",body:body,headers:{'Authorization':token},});console.log(res.statusText);return res}catch(exception){console.log('failed to send email')}}
function getApiUrl(recipient,sender,title){return"http://smartsendemailapi.azurewebsites.net/api/emails/SendEmail/?"+`to=${recipient}&`+`from=${sender}&`+`subject=${title}`}
$(document).ready(function(){$('.form').on('submit',async function(event){showSendingFeedbackMessage();event.preventDefault();console.log('Form submitted!');try{let userInputs=document.getElementsByTagName('input');let from=userInputs[0].value;let to=userInputs[1].value;let title=userInputs[2].value;let content=$('.textarea.input').val();var response=await SendEmail(to,from,title,content);let isSuccess=response!=undefined&&response.status==200;if(isSuccess){showSuccessMessage()}else{showFailureMessage()}}catch(exception){console.log('failed')}})});function goToDocumentation(){let docSection=$('#documenation');$(docSection.click(function(){docSection.scrollIntoView(!0)}))}
function showSendingFeedbackMessage(){$('.buttonWrapper')[0].style.display="none";$('#sendingFeedback')[0].innerHTML='Sending... please wait.'}
function showSuccessMessage(){$('#failed')[0].style.display="none";$('#sendingFeedback')[0].style.display="none";$('#success')[0].innerHTML='Thank you, your email is on its way!'}
function showFailureMessage(){$('#sendingFeedback')[0].style.display="none";$('#failed')[0].innerHTML='Sorry, something went wrong. '+'Please try again or contact our <a href="mailto:jennyrukman@gmail.com">support</a>.';$('.buttonWrapper')[0].style.display="block"}
